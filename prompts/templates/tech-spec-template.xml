<?xml version="1.0" encoding="UTF-8"?>
<template>
  <metadata>
    <name>Technical_Specification_Template</name>
    <version>1.3</version>
    <source>Section 6.3 of advanced_prompt_engineering_software_docs_code_final.md (lines 905-1016)</source>
    <sdlc_phase>Technical_Design</sdlc_phase>
    <last_updated>2025-10-20</last_updated>
    <changes>v1.3: Added Standardized Marker System for Open Questions with v1/v2+ workflow, required sub-fields for Tech Spec-level markers ([REQUIRES TECH LEAD], [CLARIFY BEFORE START], [BLOCKED BY], [NEEDS PAIR PROGRAMMING]), Decisions Made section, and validation checklist (Lean Analysis Report v1.4 Recommendation 5 - Enforce Standardized Marker System)</changes>
  </metadata>

  <instructions>
    <guideline>Create implementation specifications for engineering teams</guideline>
    <guideline>Include detailed API specifications with request/response examples</guideline>
    <guideline>Define data models with clear interfaces</guideline>
    <guideline>Specify security, performance, and testing requirements</guideline>
    <guideline>Provide implementation plan with phases</guideline>
  </instructions>

  <structure format="markdown">
    <![CDATA[
# Technical Specification: [Feature/System Name]

## Metadata
- **TechSpec ID:** SPEC-[XXX]
- **Date:** [YYYY-MM-DD]
- **Status:** [Proposed | Accepted | Active | Deprecated | Superseded]
- **Deciders:** [Names]
- **Parent Story ID:** US-[XXX]
- **Related PRD:** {SDLC_DOCUMENTS_URL}/prd/{id}
- **Related ADR:** {SDLC_DOCUMENTS_URL}/adr/{id}
- **Informed By Spike:** SPIKE-[XXX] (if spike provided implementation guidance)
- **Informed By Implementation Research:** {SDLC_DOCUMENTS_URL}/implementation-research

## Overview
**Summary:** [One paragraph overview]
**Related PRD:** {SDLC_DOCUMENTS_URL}/prd/{id}
**Related ADR:** {SDLC_DOCUMENTS_URL}/adr/{id}

## Research & Investigation Context

**Parent Backlog Story:** [US-XXX: Story Title]
- **Link:** {SDLC_DOCUMENTS_URL}/backlog-story/{id} (example: {SDLC_DOCUMENTS_URL}/backlog-story/234)

**Informed By Spike:** [SPIKE-XXX: Spike Title] (if applicable)
- **Link:** {SDLC_DOCUMENTS_URL}/spike/{id} (example: {SDLC_DOCUMENTS_URL}/spike/042)
- **Implementation Guidance:** [How spike findings shaped this technical spec]
- **Key Decisions:** [Decisions made based on spike evidence]

**Implementation Research References:**
**Primary Research Document:** {SDLC_DOCUMENTS_URL}/implementation-research

**Implementation Patterns Applied:**
- **§[X.Y]: [Technical Capability]:** [Detailed implementation pattern]
  - **Code Example Reference:** [Link to Appendix B example if applicable]
- **§[X.Y]: [Security Implementation]:** [Security pattern applied]
- **§[X.Y]: [Testing Strategy]:** [Testing approach from research]

**Performance Targets:**
- **§[X.Y]: [Performance Benchmarks]:** [Target metrics from research]

**Observability:**
- **§[X.Y]: [Monitoring Implementation]:** [Logging and metrics approach]

## Goals
- [Technical goal 1]
- [Technical goal 2]

## Non-Goals
- [Explicitly out of scope]

## System Architecture

**HYBRID CLAUDE.md APPROACH:** When specialized CLAUDE-*.md files exist, align component architecture with established implementation standards. Reference (not duplicate) CLAUDE.md content. Supplement with component-specific design details.

### High-Level Architecture
```mermaid
graph TD
    A[Client] --> B[API Gateway]
    B --> C[Service Layer]
    C --> D[Data Layer]
```

### Component Diagram
[Detailed component interactions]

### Alignment with Implementation Standards (when applicable)
- **CLAUDE-architecture.md:** Follow project structure patterns, modularity principles
- **CLAUDE-typing.md:** Apply type hints and type safety patterns
- **CLAUDE-validation.md:** Use Pydantic models for data validation
- **Additional domain-specific files:** Reference as needed per CLAUDE.md

**Note:** Treat CLAUDE.md content as authoritative - supplement with component-specific architecture, don't duplicate.

## API Specifications

### Endpoint: [Name]
**Method:** POST
**Path:** `/api/v1/resource`

**Request:**
```json
{
  "field1": "string",
  "field2": "number"
}
```

**Response:**
```json
{
  "id": "uuid",
  "status": "success"
}
```

**Error Codes:**
- 400: Invalid input
- 401: Unauthorized
- 500: Server error

## Data Models

### Entity: User
```typescript
interface User {
  id: UUID;
  email: string;
  createdAt: DateTime;
  // ...
}
```

## Security Considerations
- **Authentication:** [Method]
- **Authorization:** [RBAC model]
- **Data Encryption:** [At-rest, in-transit]
- **Input Validation:** [Strategy]

## Performance Requirements
- **Latency:** P95 < 200ms
- **Throughput:** 10,000 requests/sec
- **Availability:** 99.9% uptime

## Testing Strategy

**HYBRID CLAUDE.md APPROACH:** When CLAUDE-testing.md exists, reference established testing requirements. Supplement with component-specific test scenarios.

### Testing Requirements
- **Unit Tests:** [Coverage target - reference CLAUDE-testing.md minimum (e.g., 80%)]
- **Integration Tests:** [Critical paths]
- **Load Tests:** [Scenarios]

### Alignment with Testing Standards (when applicable)
- **CLAUDE-testing.md:** Follow testing strategy, coverage requirements, fixture patterns
- **CLAUDE-tooling.md:** Use Taskfile commands for test execution (`task test`, `task test:coverage`)
- Component-specific test scenarios supplement standard requirements

**Note:** Treat CLAUDE-testing.md requirements as baseline - supplement with component-specific tests.

## Deployment Strategy
- **Environment Progression:** Dev → Staging → Production
- **Rollout Plan:** [Phased rollout strategy]
- **Rollback Plan:** [Procedure]

## Monitoring & Observability
- **Key Metrics:** [List]
- **Alerts:** [Conditions and escalation]
- **Logging:** [Strategy and retention]

## Implementation Plan
### Phase 1: [Duration]
- [Task 1]
- [Task 2]

### Phase 2: [Duration]
- [Task 3]
- [Task 4]

## Decisions Made

**Note:** This section added in v2+ after feedback provided. Answered questions from Open Questions move here.

**Q1: [Question]**
- **Decision:** [Answer]
- **Rationale:** [Why this decision was made]
- **Decided By:** [Person/Role] ([Date])

## Open Questions

**Tech Spec Open Questions focus on IMPLEMENTATION-LEVEL details that require resolution during development.**

**✅ INCLUDE - Implementation Details:**
- Low-level technology/library choices not covered by ADRs
- Implementation approach questions for specific components
- Performance optimization strategies
- Testing approach details
- Component-level design pattern choices
- Minor technical decisions requiring team discussion or spike

**❌ EXCLUDE - Already Addressed in Earlier Phases:**
- Product/technical trade-offs (PRD phase)
- Major architectural decisions requiring alternatives analysis (ADR phase)
- Business questions (Epic/PRD phases)
- Significant technology choices with major consequences (ADR phase)

---

**Examples of Tech Spec-APPROPRIATE questions:**
- "Should we use Joi or Yup for request validation?"
- "What pagination strategy for the user list endpoint: cursor or offset?"
- "Should we implement retry logic with exponential backoff or fixed delay?"
- "What's the optimal batch size for bulk operations?"
- "Should we use async/await or promise chaining for this workflow?"

**Examples of questions already addressed (don't repeat):**
- ❌ "Should we use Redis or Memcached for caching?" (ADR decision)
- ❌ "Should we prioritize offline-first or real-time sync?" (PRD decision)
- ❌ "REST vs. GraphQL for API layer?" (ADR decision)

---

**MANDATORY MARKER USAGE (Hard Enforcement):**

**Version 1 Artifacts:**
- Open Questions should include **Recommendations** for each question (exploratory, not yet decided)
- Include alternatives, context, decision criteria
- No markers required in v1 (questions are exploratory)

**After Feedback (Version 2+):**
- Answered questions MUST move to **"Decisions Made"** section
- Remaining unresolved questions MUST use standardized markers:
  - [REQUIRES TECH LEAD] (senior technical input)
  - [CLARIFY BEFORE START] (must resolve before beginning task)
  - [BLOCKED BY] (external dependency)
  - [NEEDS PAIR PROGRAMMING] (complex area requiring collaboration)

**Required Sub-fields for Each Marker:**

[REQUIRES TECH LEAD]
- **Technical Question:** {Senior input needed on what}
- **Context:** {Why this needs tech lead review}
- **Blocking:** {What's blocked}

[CLARIFY BEFORE START]
- **Clarification Needed:** {Ambiguity to resolve}
- **Stakeholder:** {Who can clarify}
- **Blocking:** {Can't start task until clarified}

[BLOCKED BY]
- **Dependency:** {External system, team, decision}
- **Expected Resolution:** {Date/milestone when unblocked}
- **Workaround Available:** {Yes/No, if yes describe}

[NEEDS PAIR PROGRAMMING]
- **Complexity Area:** {What's complex requiring collaboration}
- **Skills Needed:** {Expertise required}
- **Duration:** {Estimated pairing time}

**PROHIBITED:**
- ❌ Free-form text: "Decision: Tech Lead needs to review"
- ❌ Generic actions: "Action Required: Get tech lead approval..."
- ✅ Use standardized markers with required sub-fields instead

**Exception - Meta-instruction Only:**
"Action Required:" text may be used ONLY for strong emphasis when markers are missing:
```
⚠️ **ACTION REQUIRED:** This artifact has 2 open questions without markers.
Add [REQUIRES TECH LEAD] or [CLARIFY BEFORE START] markers before finalization. ⚠️
```
(This is a meta-instruction about the artifact itself, not the actual question documentation)

---

**If no open questions exist, state:** "No open implementation questions at this time. All technical decisions addressed in PRD and ADRs."

---

- [Implementation Question 1 with marker if v2+]
- [Implementation Question 2 with marker if v2+]

## References
- [Documentation links]
    ]]>
  </structure>

  <examples>
    <example source="Section 6.3 lines 1020-1046">
      See research document for User Profile API specification example with:
      - OpenAPI 3.0 format
      - JWT authentication
      - CRUD operations
      - Error handling
    </example>
  </examples>
</template>
