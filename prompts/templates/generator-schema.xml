<?xml version="1.0" encoding="UTF-8"?>
<template>
  <metadata>
    <name>Generator_Prompt_Schema_Template</name>
    <version>2.0</version>
    <source>Extracted from Context Engineering Framework</source>
    <purpose>Standard XML schema for all generator prompts</purpose>
    <last_updated>2025-10-13</last_updated>
    <changes>v2.0: Updated for Issue #2 (Path Consolidation), Issue #3 (Input Classification), Issue #1 (Validation Consolidation)</changes>
  </metadata>

  <instructions>
    <guideline>All generator prompts must follow this XML structure</guideline>
    <guideline>Each generator produces both a terminal artifact</guideline>
    <guideline>Validation checklists ensure quality standards are met</guideline>
    <guideline>Traceability section links to input artifacts and templates</guideline>
  </instructions>

  <structure format="xml">
    <![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<generator_prompt>
  <metadata>
    <name>[Generator_Name]</name>
    <version>[version]</version>
    <sdlc_phase>[Product_Research|Vision|Initiative|Epic|PRD|Feature|High_Level_Story|Backlog_Story|Architecture|Technical_Design|Code|Test]</sdlc_phase>
    <depends_on>[Artifact type(s) - paths defined in CLAUDE.md]</depends_on>
    <generated_by>[Source that created this generator]</generated_by>
    <date>[YYYY-MM-DD]</date>
  </metadata>

  <system_role>
    You are an expert [role] with [X]+ years of experience in [domain]. You excel at [key expertise].

    Your output must follow the [Artifact Type] template structure defined in CLAUDE.md (see Folder Structure section ).
  </system_role>

  <task_context>
    <background>
      [Description of what this generator creates and why it matters in the SDLC workflow]
      [Key requirements and quality standards]

      Reference: [Any relevant research sections - for documentation only, not loaded]
    </background>

    <input_artifacts>
      <artifact classification="[mandatory|recommended|conditional]" type="[type]" mutually_exclusive_group="[group_name]">
        [Description of what this input contains and how to use it]

        **Classification**: [MANDATORY|RECOMMENDED|CONDITIONAL] - [Brief explanation of classification and impact]

        Note: Artifact paths defined in CLAUDE.md Artifact Path Patterns section.
      </artifact>
    </input_artifacts>

    <input_classification_reference>
      See CLAUDE.md Input Classification System section for complete definitions:
      - MANDATORY: Must be loaded, generator fails without it
      - RECOMMENDED: Should be loaded for quality (~20-30% quality reduction without)
      - CONDITIONAL: Loaded only under specific conditions
      - MUTUALLY_EXCLUSIVE: One of N inputs required (use mutually_exclusive_group attribute)
    </input_classification_reference>

    <constraints>
      <constraint>[CUSTOMIZE PER PRODUCT - Technical/business/timeline constraints]</constraint>
    </constraints>
  </task_context>

  <anti_hallucination_guidelines>
    <guideline category="grounding">Base all outputs on provided input artifacts. Quote or reference specific sections from inputs when making claims.</guideline>
    <guideline category="assumptions">When making inferences beyond input artifacts, explicitly mark with [ASSUMPTION] tag and explain reasoning.</guideline>
    <guideline category="uncertainty">If input artifacts lack necessary information, state "Information not provided in inputs" rather than fabricating details.</guideline>
    <guideline category="verification">For factual claims, trace back to specific sections of input artifacts or research sources.</guideline>
    <guideline category="confidence">After generating content, identify any sections where confidence is low or additional information would improve quality.</guideline>
    <guideline category="scope">Stay within the bounds of the current SDLC phase. Do not make detailed implementation decisions that belong in later phases.</guideline>
  </anti_hallucination_guidelines>

  <instructions>
    <step priority="1">
      <action>[Load and analyze input artifact]</action>
      <purpose>[Why this step is necessary]</purpose>
      <anti_hallucination>Extract facts, requirements, and constraints from input. Note any ambiguities or missing information for later clarification.</anti_hallucination>
    </step>

    <step priority="2">
      <action>[Load template]</action>
      <purpose>[Understand required structure]</purpose>
      <anti_hallucination>Follow template structure exactly. If template section cannot be filled from available inputs, note as [NEEDS CLARIFICATION] rather than inventing content.</anti_hallucination>
    </step>

    <step priority="3">
      <action>[Research phase - if applicable]</action>
      <guidance>
        - Research relevant domain information
        - Identify gaps and opportunities
        - Inform artifact generation with findings
      </guidance>
      <anti_hallucination>When incorporating research findings, cite sources. Distinguish between verified facts from research and inferences you're making.</anti_hallucination>
    </step>

    <step priority="[N-2]">
      <action>[Generate terminal artifact]</action>
      <output_path>[/artifacts/path/artifact_v1.md]</output_path>
    </step>

    <step priority="[N]">
      <action>Validate generated artifact</action>
      <guidance>
        If any criterion fails validation:
        1. Present a validation report showing:
           - Failed criteria with IDs (e.g., "CQ-03: FAILED - Only 8 user stories...")
           - Passed criteria can be summarized
        2. Ask the human to confirm whether to regenerate
      </guidance>
      <reference>See validation_checklist below</reference>
    </step>
  </instructions>

  <output_format>
    <terminal_artifact>
      <path>[/artifacts/path/artifact_v1.md]</path>
      <format>[Markdown following template structure]</format>
      <validation_checklist>
        <!-- Content Quality Criteria -->
        <criterion id="CQ-01" category="content">[Phase-specific content criterion 1]</criterion>
        <criterion id="CQ-02" category="content">[Phase-specific content criterion 2]</criterion>
        <criterion id="CQ-03" category="content">[Phase-specific content criterion 3]</criterion>

        <!-- Traceability Criteria -->
        <criterion id="TR-01" category="traceability">References to input artifact(s) present with specific sections cited</criterion>
        <criterion id="TR-02" category="traceability">All decisions trace back to input artifact requirements or marked as [ASSUMPTION]</criterion>

        <!-- Consistency Criteria -->
        <criterion id="CC-01" category="consistency">Terminology consistent with input artifacts and SDLC framework</criterion>
        <criterion id="CC-02" category="consistency">Formatting follows template structure exactly</criterion>
        <criterion id="CC-03" category="consistency">Readability: Accessible to target audience (Flesch score >60 target for docs)</criterion>
      </validation_checklist>
    </terminal_artifact>

  </output_format>

  <traceability>
    <source_document>[Artifact type] artifact (see CLAUDE.md for path pattern)</source_document>
    <template>[Artifact Type] template (see CLAUDE.md Folder Structure section )</template>
    <research_reference>[Optional: Section references for documentation only]</research_reference>
    <strategy_reference>[Optional: Section references for documentation only]</strategy_reference>
  </traceability>

  <quality_guidance>
    <guideline category="completeness">
      Every section in the template must be filled with substantive content. Avoid placeholder text like "[To be determined]". If information is unknown, make reasonable inferences based on inputs and explicitly note assumptions.
    </guideline>

    <guideline category="clarity">
      Write for the target audience of this phase. Avoid jargon unless necessary, and define technical terms when used. Use concrete examples.
    </guideline>

    <guideline category="actionability">
      Content should provide clear next steps and guidance. Avoid vague statements. Be specific and concrete.
    </guideline>

    <guideline category="traceability">
      Reference input artifacts with clear attribution. This allows readers to trace decisions and content back to source.
    </guideline>
  </quality_guidance>

  <examples>
    <example type="[type]">
      Good: [Positive example demonstrating best practice]

      Bad: [Counter-example showing what to avoid]
    </example>
  </examples>
</generator_prompt>
    ]]>
  </structure>

  <key_elements>
    <element name="metadata">
      <description>Tracks generator identity, version, dependencies, and provenance</description>
      <required_fields>name, version, sdlc_phase, depends_on, generated_by, date</required_fields>
      <note>depends_on references artifact types, paths defined in CLAUDE.md</note>
    </element>

    <element name="system_role">
      <description>Defines expert persona and primary responsibility</description>
      <must_reference>Template structure from CLAUDE.md Folder Structure section </must_reference>
    </element>

    <element name="task_context">
      <description>Provides background, inputs, and constraints</description>
      <must_include>Background explanation, input artifact descriptions with classification, constraints</must_include>
      <note>Input artifacts use classification attribute (mandatory/recommended/conditional) instead of required</note>
    </element>

    <element name="input_artifacts">
      <description>Defines input artifacts with classification system</description>
      <attributes>classification (mandatory/recommended/conditional), type, mutually_exclusive_group (optional)</attributes>
      <must_document>Classification rationale and quality impact for each input</must_document>
      <reference>See CLAUDE.md Input Classification System for definitions</reference>
    </element>

    <element name="instructions">
      <description>Step-by-step execution guidance with priority ordering</description>
      <must_include>Load inputs, load template, research (if applicable), generate terminal artifact, validate with failure reporting</must_include>
    </element>

    <element name="output_format">
      <description>Specifications for terminal artifact</description>
      <must_include>Formats, validation_checklist with IDs and categories (content, traceability, consistency)</must_include>
    </element>

    <element name="validation_checklist">
      <description>Single consolidated checklist with unique IDs and categories</description>
      <format>criterion id="[XX-##]" category="[content|traceability|consistency]"</format>
      <note>Replaces old duplicate validation sections. IDs enable specific failure reporting.</note>
    </element>

    <element name="traceability">
      <description>Links to source documents and references (documentation only)</description>
      <note>References CLAUDE.md for path patterns. Not required context loading.</note>
    </element>

    <element name="quality_guidance">
      <description>Best practices for completeness, clarity, actionability, traceability</description>
      <categories>completeness, clarity, actionability, traceability</categories>
    </element>

    <element name="examples">
      <description>Concrete good/bad examples for key output types</description>
      <purpose>Demonstrates standards and common pitfalls</purpose>
    </element>
  </key_elements>

  <usage_notes>
    <note>When creating a new generator, copy this structure and fill in phase-specific details</note>
    <note>Use classification system for input artifacts: mandatory/recommended/conditional (see CLAUDE.md)</note>
    <note>Document quality impact for recommended inputs (e.g., "~20% quality reduction without")</note>
    <note>Validation checklist must use IDs (CQ-##, TR-##, CC-##) and categories for failure reporting</note>
    <note>Reference CLAUDE.md for all paths - use natural language references, not hardcoded paths</note>
    <note>Remove duplicate validation sections - single validation_checklist only</note>
    <note>Research steps should be included for Vision, Epic, and PRD phases</note>
    <note>Constraints should be marked [CUSTOMIZE PER PRODUCT] for reusable generators</note>
    <note>References in traceability section are for documentation only - not loaded into context</note>
  </usage_notes>

  <consolidation_changes>
    <change issue="1" name="Validation Consolidation">
      <summary>Single validation_checklist with IDs and categories</summary>
      <changes>
        - Removed duplicate &lt;validation&gt;&lt;self_check&gt; section
        - Added unique IDs (CQ-##, TR-##, CC-##) to validation criteria
        - Added categories (content, traceability, consistency)
        - Added failure reporting guidance in validation step
      </changes>
    </change>

    <change issue="2" name="Path Consolidation">
      <summary>Centralized paths in CLAUDE.md</summary>
      <changes>
        - Removed hardcoded paths from metadata and traceability
        - Added references to CLAUDE.md Folder Structure section
        - Use natural language: "see CLAUDE.md for path pattern"
      </changes>
    </change>

    <change issue="3" name="Input Classification">
      <summary>4-tier classification system replacing required attribute</summary>
      <changes>
        - Replaced required="true/false" with classification="mandatory/recommended/conditional"
        - Added mutually_exclusive_group attribute for OR relationships
        - Added input_classification_reference section
        - Document quality impact for each input classification
        - Reference CLAUDE.md Input Classification System section
      </changes>
    </change>
  </consolidation_changes>
</template>
